{% extends 'MyBlog/base.html' %}
{% load static %}
{% block title%}
    <title>花花与风-{{ Blog.title }}</title>
{% endblock %}
{% block head %}
    <link rel="stylesheet" href="{% static 'common/css/share.min.css' %}">
    <link rel="stylesheet" href="{% static 'common/css/paging.css' %}">
{% endblock %}
{% block nav %}
<div class="nav" id="nav">
 <div class="menu-btn">
      <div class="menu"></div>
    </div>
    <div class="item">
        <a class="navpic" href="../"><img src="{% static 'common/imgs/logo.png' %}"></a>
        <ul class="nav-horizontal">
            <li class="nav-item  layui-this"><a href="../blog">博客</a></li>
{#            <li class="layui-nav-item"><a href="../picture">相册</a></li>#}
            <li class="nav-item"><a href="../weblink">友情链接</a></li>
            <li class="nav-item"><a href="../archive">归档</a></li>
            <li class="nav-item"><a href="../message">留言</a></li>
            <li class="nav-item layui-this"><a href="../about">关于</a></li>
        </ul>
        <ul class="nav-tree">
            <li class="nav-item  layui-this"><a href="../blog">博客</a></li>
{#            <li class="layui-nav-item"><a href="../picture">相册</a></li>#}
            <li class="nav-item"><a href="../weblink">友情链接</a></li>
            <li class="nav-item"><a href="../archive">归档</a></li>
            <li class="nav-item"><a href="../message">留言</a></li>
            <li class="nav-item"><a href="../about">关于</a></li>
        </ul>
    </div>
</div>
{% endblock %}
{% block container %}
    <div class="layui-col-md9">
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="blog-content ">
                    <div class="blog-head">
                        <div class="blog-title">
                            <h3>{{ Blog.title }}</h3>
                        </div>
                        <div class="con-desc">
                            <a>创建日期：{{ Blog.createdate|date:"Y-m-d H:i:s" }}</a>
                            <a>发布者：{{ Blog.author }}</a>
                            <a>点击量：{{ Blog.hit }}</a>
                        </div>
                    </div>
                    <div class="text-con">
                        {% autoescape off %}
                            {{ Blog.blogcontent }}
                        {% endautoescape %}
                    </div>
                    <div class="text-desc">
                        <div class="">
                            本文标题：{{ Blog.title }}
                        </div>
                        <div class="">
                            本文链接：<a id="urlinfo"></a>
                        </div>
                        <div class="">
                            本文标签：
                            {% if Blog.blog_blogtype  %}
                                {% for BlogType in Blog.blog_blogtype.all %}
                                    <span class="layui-badge-rim">
                           <a href="{% url 'MyBlog:types' BlogType.TypeName %}">{{ BlogType.TypeName }}</a>
                       </span>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="">
                            <p>非特殊说明，本文版权归 夏天的风博客 所有，转载请注明出处.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="comment-content">
                    <div class="font-border"><h2>分享一下</h2></div>
                </div>
                <div class="share">
                    <ul>
                        <div id="share-2"></div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="comment-content">
                    <div class="font-border"><h2>评论</h2></div>
                </div>
                <div id="reply" >
                    <div class="reply-con">
                        <form class="layui-form">
                            {% csrf_token %}
                            <div class="userinfo">
                                <div class="input-icon">
                                    <div class="input-inline">
                                        <input type="tel" id="username" lay-verify="" autocomplete="off" class="username" placeholder="昵称（必填）">
                                    </div>
                                </div>
                                <div class="input-icon">
                                    <div class="input-inline">
                                        <input type="text" id="email" lay-verify="" autocomplete="off" class="email" placeholder="邮箱（必填）">
                                    </div>
                                </div>
                                <div class="input-icon">
                                    <div class="input-inline">
                                        <input type="text" id="website" lay-verify="" autocomplete="off" class="website" placeholder="站点">
                                    </div>
                                </div></div>
                            <div class="text">
                                <textarea id="commentContent"  placeholder="请输入内容" class="layui-textarea"></textarea>
                            </div>
                            <div class="text">
                                <button class="layui-btn"  type="button" id="sb-btn">发表</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% if Blog.comment_set.all %}
            <div class="layui-card">
                <div class="layui-card-body">
                    <div class="message-content" >
                        <div class="comment-content">
                            <div class="font-border"><h2 class="commentcount">{{ Blog.comment_set.count }}条评论</h2></div>
                        </div>
                        <div id="messagetext">
                        </div>
                        {#                        {% for comment in Blog.comment_set.all %}#}
                        {#                            <div class="media-body">#}
                        {#                                <div class="media-left">#}
                        {#                                    <img src="../{{ comment.userpic }}">#}
                        {#                                </div>#}
                        {#                                <div class="pad-btm">#}
                        {#                                    <p class="fontColor"><a>{{ comment.username }}</a></p>#}
                        {#                                    <div class="min-font">#}
                        {#                                      <span class="layui-breadcrumb" lay-separator="-">#}
                        {#                                        <a class="layui-icon layui-icon-cellphone"></a>#}
                        {#                                        <a>{{ comment.device }}</a>#}
                        {#                                        <a class="time" datetime="{{ comment.createdate|date:"Y-m-d H:i:s" }}"></a>#}
                        {#                                      </span>#}
                        {#                                    </div>#}
                        {#                                    <p class="message-text">{{ comment.commentContent }}</p>#}
                        {#                                </div>#}
                        {#                                                        <div class="reply-text">#}
                        {#                                                            {% if comment.reply_set.all %}#}
                        {#                                                                <div class="reply-container">#}
                        {#                                                                    {% for reply in comment.reply_set.all %}#}
                        {#                                                                        <div class="box-reply">#}
                        {#                                                                            <div class="title">#}
                        {#                                                                                <img src="{% static 'common/imgs/userhead.png' %}">#}
                        {#                                                                                <p>{{ reply.user.username }}</p>#}
                        {#                                                                            </div>#}
                        {#                                                                            <div class="brower">四川.成都  Windows 10  Chrome|65</div>#}
                        {#                                                                            <div class="replyContent"><p>{{ reply.replyContent }}</p></div>#}
                        {#                                                                            <div class="other">#}
                        {#                                                                                <div class="like">#}
                        {#                                                                                    <button class="layui-btn" id="replylike{{ reply.id }}"><i class="layui-icon">&#xe6c6;</i></button>#}
                        {#                                                                                    <span class="layui-btn"><p class="replylikecon{{ reply.id }}">{{ reply.likeNum }}</p></span>#}
                        {#                                                                                </div>#}
                        {#                                                                                <div lay-separator="-" class="reply-date">#}
                        {#                                                                                    <a class="replytime" datetime="{{ reply.createdate|date:"Y-m-d H:i:s" }}"></a>#}
                        {#                                                                                </div>#}
                        {#                                                                            </div>#}
                        {#                                                                        </div>#}
                        {#                                                                    {% endfor %}#}
                        {#                                                                </div>#}
                        {#                                                            {% endif %}#}
                        {#                                                        </div>#}
                        {#                                <div class="reply-comment">#}
                        {#                                    <div class="like">#}
                        {#                                        <button class="layui-btn" id="like{{ comment.id }}"><i class="layui-icon">&#xe6c6;</i></button>#}
                        {#                                        <button class="layui-btn"><p class="likecon{{ comment.id }}">{{ comment.likeNum }}</p></button>#}
                        {#                                    </div>#}
                        {#                                    <div class="reply-btn">#}
                        {#                                        <button class="layui-btn"><i class="layui-icon">&#xe611;</i></button>#}
                        {#                                        <button class="layui-btn" id='replylabel{{ comment.id }}'>回复</button>#}
                        {#                                    </div>#}
                        {#                                </div>#}
                        {#                                <form  id="formyz">#}
                        {#                                    {% csrf_token %}#}
                        {#                                    <div class="reply-to-text" id="reply{{ comment.id }}" style="display: none">#}
                        {#                                        <div class="text">#}
                        {#                                            <textarea class="reply-box-textarea" id="replyContent{{ comment.id }}"></textarea>#}
                        {#                                        </div>#}
                        {#                                        <div class="replybtn"><button class="layui-btn" id="replybtn{{ comment.id }}" type="button" >回复</button></div>#}
                        {#                                    </div>#}
                        {#                                </form>#}
                        {#                            </div>#}
                        {#                        {% endfor %}#}
                    </div>
                    <div id="blogpagination"></div>
                </div>
            </div>
        {% endif %}
    </div>
    <div class="layui-col-md3" >
        <div class="content-sapce-15">
            <div class="layui-col-md12 ">
                <div class="layui-card webinfo">
                    <div class="layui-card-header">
                        <i class="layui-icon layui-icon-app"></i>
                        <span>文章分类</span>
                    </div>
                    <div class="layui-card-body">
                        <ul>
                            {% if Categorys %}
                                {% for category in Categorys %}
                                    <a href="{% url 'MyBlog:category' category.id %}" title="{{ category.Name }}"><li>{%if category.Name|length >= 25 %}{{category.Name|slice:"25"}}...{%else%} {{category.Name}}{%endif%}</li></a>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="layui-col-md12">
                <div class="layui-card ranker">
                    <div class="layui-card-header">
                        <i class="iconfont icon-wenzhang"></i>
                        <span>点击排行</span>
                    </div>
                    <div class="layui-card-body">
                        <ul>
                            {% if Rankers %}
                                {% for ranker in Rankers %}
                                    <li><a href="{% url 'MyBlog:details' ranker.id %}" title="{{ ranker.title }}">{%if ranker.title|length >= 25 %}
                                        {{ranker.title|slice:"25"}}...
                                    {%else%} {{ranker.title}}
                                    {%endif%}</a></li>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <i class="layui-icon layui-icon-note"></i>
                        <span>标签云</span>
                    </div>
                    <div class="layui-card-body note">
                        {% if Tags %}
                            {% for tag in Tags %}
                                <a  href="{% url 'MyBlog:types' tag.TypeName %}">{{ tag.TypeName }}</a>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock %}
{% block script %}
    <script src="{% static '/common/js/jquery.timeago.js' %}" ></script>
    <script src="{% static '/js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static '/common/js/paging.js' %}"></script>
    <script src="{% static '/common/js/share.min.js' %}"></script>
    <script>
        $('#share-2').share({sites: ['qzone', 'qq', 'weibo','wechat','douban']});
        $("#urlinfo").html(window.location.href)
        $("#urlinfo").attr('href',window.location.href)
        console.log(window.location.href)
    </script>
    <script type="text/javascript">
        var devide=''
        var brower=''
        var system=''
        $(function(){
            LoadComment(1,10);
        });
        (function($){
            var BrowserMatch = {
                init: function() {
                    this.browser = this.getBrowser().browser || "未知浏览器";  //获取浏览器名
                    this.version = this.getBrowser().version || "未知浏览器版本号";  //获取浏览器版本
                    this.OS = this.getOS()+" "+this.getDigits() || "未知操作系统"; //系统版本号
                },
                getOS: function() {  //判断所处操作系统
                    var sUserAgent = navigator.userAgent.toLowerCase();

                    var isWin = (navigator.platform == "Win32") || (navigator.platform == "Win64")|| (navigator.platform == "wow64");

                    var isMac = (navigator.platform == "Mac68K") || (navigator.platform == "MacPPC") || (navigator.platform == "Macintosh") || (navigator.platform == "MacIntel");
                    if (isMac) return "Mac";
                    var isUnix = (navigator.platform == "X11") && !isWin && !isMac;
                    if (isUnix) return "Unix";
                    var isLinux = (String(navigator.platform).indexOf("Linux") > -1);
                    var bIsAndroid = sUserAgent.toLowerCase().match(/android/i) == "android";
                    if (isLinux) {
                        if(bIsAndroid) return "Android";
                        else return "Linux";
                    }
                    if (isWin) {

                        var isWin2K = sUserAgent.indexOf("Windows nt 5.0") > -1 || sUserAgent.indexOf("Windows 2000") > -1;
                        if (isWin2K) return "Win2000";
                        var isWinXP = sUserAgent.indexOf("Windows nt 5.1") > -1 || sUserAgent.indexOf("Windows XP") > -1
                        sUserAgent.indexOf("Windows XP") > -1;
                        if (isWinXP) return "WinXP";
                        var isWin2003 = sUserAgent.indexOf("Windows nt 5.2") > -1 || sUserAgent.indexOf("Windows 2003") > -1;
                        if (isWin2003) return "Win2003";
                        var isWinVista= sUserAgent.indexOf("Windows nt 6.0") > -1 || sUserAgent.indexOf("Windows Vista") > -1;
                        if (isWinVista) return "WinVista";
                        var isWin7 = sUserAgent.indexOf("Windows nt 6.1") > -1 || sUserAgent.indexOf("Windows 7") > -1;
                        if (isWin7) return "Win7";
                        var isWin8 = sUserAgent.indexOf("windows nt 6.2") > -1 || sUserAgent.indexOf("Windows 8") > -1;
                        if (isWin8) return "Win8";
                        var isWin10 = sUserAgent.indexOf("windows nt 10.0")>-1||sUserAgent.indexOf("Windows 10")>-1;
                        if(isWin10)return "Win10";
                    }
                    return "其他";
                },
                getDigits:function(){ //判断当前操作系统的版本号
                    var sUserAgent = navigator.userAgent.toLowerCase();
                    var is64 = sUserAgent.indexOf("win64") > -1||sUserAgent.indexOf("wow64") > -1;
                    if (is64) {
                        return "64位";
                    }else{
                        return "32位";
                    }
                },
                getBrowser: function() {  // 获取浏览器名
                    var rMsie = /(msie\s|trident\/7)([\w\.]+)/;
                    var rTrident = /(trident)\/([\w.]+)/;
                    var rEdge = /(chrome)\/([\w.]+)/;//IE

                    var rFirefox = /(firefox)\/([\w.]+)/;  //火狐
                    var rOpera = /(opera).+version\/([\w.]+)/;  //旧Opera
                    var rNewOpera = /(opr)\/(.+)/;  //新Opera 基于谷歌
                    var rChrome = /(chrome)\/([\w.]+)/; //谷歌
                    var rUC = /(chrome)\/([\w.]+)/;//UC
                    var rMaxthon = /(chrome)\/([\w.]+)/;//遨游
                    var r2345 =  /(chrome)\/([\w.]+)/;//2345
                    var rQQ =  /(chrome)\/([\w.]+)/;//QQ
                    //var rMetasr =  /(metasr)\/([\w.]+)/;//搜狗
                    var rSafari = /version\/([\w.]+).*(safari)/;

                    var ua = navigator.userAgent.toLowerCase();


                    var matchBS, matchBS2;

                    //IE 低版
                    matchBS = rMsie.exec(ua);
                    if (matchBS != null) {
                        matchBS2 = rTrident.exec(ua);
                        if (matchBS2 != null) {
                            switch (matchBS2[2]) {
                                case "4.0":
                                    return {
                                        browser:
                                            "Microsoft IE",
                                        version: "IE: 8"  //内核版本号
                                    };
                                    break;
                                case "5.0":
                                    return {
                                        browser:
                                            "Microsoft IE",
                                        version: "IE: 9"
                                    };
                                    break;
                                case "6.0":
                                    return {
                                        browser:
                                            "Microsoft IE",
                                        version: "IE: 10"
                                    };
                                    break;
                                case "7.0":
                                    return {
                                        browser:
                                            "Microsoft IE",
                                        version: "IE: 11"
                                    };
                                    break;
                                default:
                                    return {
                                        browser:
                                            "Microsoft IE",
                                        version: "Undefined"
                                    };
                            }
                        } else {
                            return {
                                browser: "Microsoft IE",
                                version: "IE:"+matchBS[2] || "0"
                            };
                        }
                    }
                    //IE最新版
                    matchBS = rEdge.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent))) {
                        return {
                            browser: "Microsoft Edge",
                            version: "Chrome/"+matchBS[2] || "0"
                        };
                    }
                    //UC浏览器
                    matchBS = rUC.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent))) {
                        return {
                            browser: "UC",
                            version: "Chrome/"+matchBS[2] || "0"
                        };
                    }
                    //火狐浏览器
                    matchBS = rFirefox.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent))) {
                        return {
                            browser: "火狐",
                            version: "Firefox/"+matchBS[2] || "0"
                        };
                    }
                    //Oper浏览器
                    matchBS = rOpera.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent))) {
                        return {
                            browser: "Opera",
                            version: "Chrome/"+matchBS[2] || "0"
                        };
                    }
                    //遨游
                    matchBS = rMaxthon.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent))) {
                        return {
                            browser: "遨游",
                            version: "Chrome/"+matchBS[2] || "0"
                        };
                    }
                    //2345浏览器
                    matchBS = r2345.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent))) {
                        return {
                            browser: "2345",
                            version: "Chrome/ "+matchBS[2] || "0"
                        };
                    }
                    //QQ浏览器
                    matchBS = rQQ.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent))) {
                        return {
                            browser: "QQ",
                            version: "Chrome/"+matchBS[2] || "0"
                        };
                    }
                    //Safari（苹果）浏览器
                    matchBS = rSafari.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent)) && (!(window.chrome)) && (!(window.opera))) {
                        return {
                            browser: "Safari",
                            version: "Safari/"+matchBS[1] || "0"
                        };
                    }
                    //谷歌浏览器
                    matchBS = rChrome.exec(ua);
                    if ((matchBS != null) && (!(window.attachEvent))) {
                        matchBS2 = rNewOpera.exec(ua);
                        if (matchBS2 == null) {
                            return {
                                browser: "谷歌",
                                version: "Chrome/"+matchBS[2] || "0"
                            };
                        } else {
                            return {
                                browser: "Opera",
                                version: "opr/"+matchBS2[2] || "0"
                            };
                        }
                    }
                }
            };
            BrowserMatch.init();
            brower=BrowserMatch.browser
            system=BrowserMatch.OS
            {#alert("当前浏览器为：" + BrowserMatch.browser +"\n版本为："+ BrowserMatch.version + "\n所处操作系统为："+BrowserMatch.OS); #}
        })(jQuery);


        //检测平台
        var p = navigator.platform;
        system.win = p.indexOf("Win") == 0;
        system.mac = p.indexOf("Mac") == 0;
        system.x11 = (p == "X11") || (p.indexOf("Linux") == 0);
        system.ipad = (navigator.userAgent.match(/iPad/i) != null)?true:false;
        //跳转语句，如果是手机访问就自动跳转到wap.baidu.com页面
        if (system.win || system.mac || system.xll||system.ipad) {
            console.log('电脑端')
            devide='电脑端'
        } else if(system.mac)
        {
            console.log('MAC端')
            devide='mac端'
        }
        else if(system.xll)
        {
            console.log('OK')
            devide='x11或者Linux端'
        }
        else if(system.ipad)
        {
            console.log('ipad端')
            devide='ipad端'
        }
        else
        {
            console.log('手机端')
            devide='手机端'
        }
        layui.use('layer', function(){
            var layer = layui.layer;
            $("#sb-btn").click(function(){
                if($("#username").val()=="")
                {
                    layer.msg('请输入昵称',{time:0.5*1000})
                }
                else if($("#email").val()=="")
                {
                    layer.msg('邮箱必填',{time:0.5*1000})
                }
                else if($("#commentContent").val()=="")
                {
                    layer.msg('评论不能为空',{time:0.5*1000})
                }
                else
                {
                    $.ajax({
                        type:"POST",
                        data: {'username':$("#username").val(),'email':$("#email").val(),'blogid':{{Blog.id}},'csrfmiddlewaretoken':$("[name='csrfmiddlewaretoken']").val(),'commentContent':$("#commentContent").val(),'replytype':"0",'device':devide,'brower':brower,'system':system},
                        url: "{% url 'MyBlog:commentdata' %}", //后台处理函数的url
                        cache: false,
                        async : false,
                        success: function(result,stutas){
                            {#console.log(result.message)#}
                            if(result.message="0")
                            {
                                {#console.log(result.message)#}
                                layer.msg('评论成功!',{time:0.5*1000})
                                {#location.reload()#}
                                $(".commentcount").find('*').remove();
                                $(".commentcount").html(result.commentcount+'条评论')
                                LoadComment(1,10)
                                {#console.log(result.data)#}
                            }
                        }
                    });
                }
            });
        });

        //加载初始化数据
        function LoadComment(currPage, pageSize){
            console.log('继续加载')
            $.ajax({
                type:'GET',
                dataType: "json",
                url:"../../loadcommentdata/",
                data:{
                    'blogid':{{ Blog.id }},'page':currPage,'limit':pageSize
                },
                success:function(result){
                    if(result.code=="0"){
                        {#console.log(result);#}
                        {#alert(res.msg);#}
                        var info = result.data;
                        var str = ""
                        $.each(result.data, function (i, item) {
                            var replystr = ""
                            var topstr = "<div class=\"reply-text\"><div class=\"reply-container\">\n"
                            var bottomstr = "</div></div>"
                            $.each(item.replylist, function (i, item) {
                                {#console.log('liebiao', item.replylist)#}
                                replystr +=
                                    "<div class=\"box-reply\">\n" +
                                    "<div class=\"title\">\n" +
                                    "<img src=\"../"+item.userpic+"\">\n" +
                                    "<p>用户" + item.id + "</p></div>\n" +
                                    "<div class=\"brower\">"+item.country+" ▪ "+item.region+" ▪ "+item.city+" - "+item.system+" - "+item.brower+"</div>\n" +
                                    "<div class=\"replyContent\"><p>" + item.replyContent + "</p></div><div class=\"other\">\n" +
                                    "<div class=\"like\">\n" +
                                    "<button class=\"layui-btn\" id=\"replylike" + item.id + "\"><i class=\"layui-icon\">&#xe6c6;</i></button>\n" +
                                    "<span class=\"layui-btn\"><p class=\"replylikecon" + item.id + "\">" + item.likeNum + "</p></span></div>\n" +
                                    "<div class=\"reply-date\">\n" +
                                    "<a class=\"replytime\" datetime=\"" + item.createdate + "+08:00\"></a></div></div></div>"
                            });
                            if (item.replylist.length > 0) {
                                replystr = topstr + replystr + bottomstr
                            }

                            var vfields = item;  //这里不定义也行，在下面的调用中直接使用item，请忽略我不规范的缩进

                            str += " <div class=\"media-body\">\n" +
                                "                                    <div class=\"media-left\">\n" +
                                "                                        <img src=\"../" + vfields.userpic + " \">\n" +
                                "                                    </div>\n" +
                                "                                    <div class=\"pad-btm\">\n" +
                                "                                        <p class=\"fontColor\"><a>" + vfields.username + "</a></p>\n" +
                                "                                        <div class=\"min-font\">\n" +
                                "                                          <span >\n" +
                                "                                            <a class=\"layui-icon layui-icon-cellphone\"> - </a>\n" +
                                "                                            <a>" + vfields.device + " - </a>\n" +
                                "                                            <a class=\"time\" datetime=\"" + vfields.createdate + "+08:00\"> </a>\n" +
                                "                                         <a class=\"brower\"> - "+vfields.country+" ▪ "+vfields.region+" ▪ "+vfields.city+" - "+vfields.system+" - "+vfields.brower+"</a>\n" +
                                "                                          </span>\n" +
                                "                                        </div>\n" +
                                "                                        <p class=\"message-text\">" + vfields.commentContent + "</p>\n" +
                                "                                    </div>\n" + replystr +

                                "                                    <div class=\"reply-text\">\n" +
                                "                                    </div>\n" +
                                "                                    <div class=\"reply-comment\">\n" +
                                "                                        <div class=\"like\">\n" +
                                "                                            <button class=\"layui-btn\" id=\"like" + vfields.id + "\"><i class=\"layui-icon\">&#xe6c6;</i></button>\n" +
                                "                                            <button class=\"layui-btn\"><p class=\"likecon" + vfields.id + "\">" + vfields.likeNum + "</p></button>\n" +
                                "                                        </div>\n" +
                                "                                        <div class=\"reply-btn\">\n" +
                                "                                            <button class=\"layui-btn\"><i class=\"layui-icon\">&#xe611;</i></button>\n" +
                                "                                            <button class=\"layui-btn\" id='replylabel" + vfields.id + "'>回复</button>\n" +
                                "                                        </div>\n" +
                                "                                    </div>\n" +
                                "                                    <form  id=\"formyz\">\n" +
                                {#"                                        {% csrf_token %}\n" +#}
                                "                                        <div class=\"reply-to-text\" id=\"reply" + vfields.id + "\" style=\"display: none\">\n" +
                                "                                            <div class=\"text\">\n" +
                                "                                                <textarea class=\"reply-box-textarea\" id=\"replyContent" + vfields.id + "\"></textarea>\n" +
                                "                                            </div>\n" +
                                "                                            <div class=\"replybtn\"><button class=\"layui-btn\" id=\"replybtn" + vfields.id + "\" type=\"button\" >回复</button></div>\n" +
                                "                                        </div>\n" +
                                "                                    </form>\n" +
                                "                                </div>"
                        });
                        {#console.log('评论：',str)#}
                        if(str.length>0)
                        {
                            $("#blogpagination").whjPaging({
                                //设为true时，ajax里的success函数必须调用setPage方法，否则分页插件显示保持不变
                                isResetPage: true,
                                css: 'css-4',
                                isShowSkip: false,
                                isShowRefresh: false,
                                isShowPageSizeOpt: false,
                                isShowFL: true,
                                isShowTotalPage: false,
                                isShowTotalSize: false,
                                callBack: function(currPage, pageSize) {
                                    LoadComment(currPage, 10);
                                }
                            });
                            $("#messagetext").find('*').remove();
                            var javascriptexec=$(str);
                            $("#messagetext").append(javascriptexec);
                            $(javascriptexec).find("[id^=like]").click(function(){
                                commentid=$(this).attr("id").split("like")[1]
                                $.ajax({
                                    type:"POST",
                                    data: {'commentid':commentid,'csrfmiddlewaretoken':$("[name='csrfmiddlewaretoken']").val()},
                                    url: "{% url 'MyBlog:like' %}", //后台处理函数的url
                                    cache: false,
                                    async : false,
                                    success: function(result){
                                        {#console.log(result.message)#}
                                        if(result.message="0")
                                        {
                                            {#console.log(result.message)#}
                                            layer.msg('点赞成功',{time:0.5*1000})
                                            var likecon='likecon'+commentid
                                            $("."+likecon).html(result.like)
                                            console.log(result.like,$("."+likecon).html())
                                        }
                                    },
                                    error: function(){
                                        layer.msg('传输格式有误，请检查')
                                    }
                                });
                            })
                            $(javascriptexec).find('[id^=replylabel]').click(function ()
                            {
                                {#console.log($(this).css("display"))#}
                                id=$(this).attr("id").split("replylabel")[1]
                                {#console.log(id)#}
                                var replyid='reply'+id
                                var replylabelid='replylabel'+id
                                replysbid=id
                                replyContentid='replyContent'+id
                                if($('#'+replyid).css("display")=='block')
                                {
                                    $('#'+replyid).css("display", "none")
                                    $(this).text("回复")
                                }
                                else
                                {
                                    $("#formyz div[id^='reply']").not("#"+replyid).css("display", "none")
                                    $("#reply-comment button[id^='replylabel']").not("#"+replylabelid).text("回复")
                                    {#console.log($("#reply-comment button[id^='replylabel']"))#}
                                    $('#'+replyid).css("display","block")
                                    $(this).text("收起")
                                }
                            })
                            {#回复评论#}
                            var replysbid=''
                            var replyContentid=''
                            $(javascriptexec).find("[id^=replybtn]").click(function(){
                                var replyid='reply'+replysbid
                                var replylabelid='replylabel'+replysbid
                                if($("#"+replyContentid).val()=="")
                                {
                                    layer.msg('回复不能为空!',{time:0.5*1000})
                                }
                                else
                                {
                                    $.ajax({
                                        type:"POST",
                                        data: {'userid':"1",'commentid':replysbid,'blogid':{{Blog.id}},'csrfmiddlewaretoken':$("[name='csrfmiddlewaretoken']").val(),'replyContent':$("#"+replyContentid).val(),'device':devide,'brower':brower,'system':system},
                                        url: "{% url 'MyBlog:replydata' %}", //后台处理函数的url
                                        cache: false,
                                        async : false,
                                        success: function(result){
                                            if(result.message="0")
                                            {
                                                console.log("回复成功")
                                                layer.msg('回复成功',{time:0.5*1000})
                                                {#location.reload()#}
                                                LoadComment(1,10)
                                                console.log(replyid)
                                                $('#'+replyid).css("display", "none")
                                                $('#'+replylabelid).text("回复")
                                            }
                                        },
                                        error: function(){
                                            {#$('#test1').html('传输格式有错误')#}
                                            {#layer.confirm(result)#}
                                            layer.msg('传输格式有误，请检查')
                                        }
                                    });
                                }
                            })
                            $(javascriptexec).find("[id^=replylike]").click(function(){
                                replyid=$(this).attr("id").split("replylike")[1]
                                $.ajax({
                                    type:"POST",
                                    data: {'replyid':replyid,'csrfmiddlewaretoken':$("[name='csrfmiddlewaretoken']").val()},
                                    url: "{% url 'MyBlog:replylike' %}", //后台处理函数的url
                                    cache: false,
                                    async : false,
                                    success: function(result){
                                        console.log(result.message)
                                        if(result.message="0")
                                        {
                                            console.log(result.message)
                                            layer.msg('点赞成功',{time:0.5*1000})
                                            var replylikecon='replylikecon'+replyid
                                            $("."+replylikecon).html(result.replylike)
                                            console.log(result.replylike,$("."+replylikecon).html())

                                        }
                                    },
                                    error: function(){
                                        layer.msg('传输格式有误，请检查')
                                    }
                                });
                            })
                            var timeagoInstance = timeago();// 实例
                            timeagoInstance.render(document.querySelectorAll('.time'),'zh_CN');
                            timeagoInstance.render(document.querySelectorAll('.replytime'),'zh_CN');

                            (function($){
                                var BrowserMatch = {
                                    init: function() {
                                        this.browser = this.getBrowser().browser || "未知浏览器";  //获取浏览器名
                                        this.version = this.getBrowser().version || "未知浏览器版本号";  //获取浏览器版本
                                        this.OS = this.getOS()+" "+this.getDigits() || "未知操作系统"; //系统版本号
                                    },
                                    getOS: function() {  //判断所处操作系统
                                        var sUserAgent = navigator.userAgent.toLowerCase();

                                        var isWin = (navigator.platform == "Win32") || (navigator.platform == "Win64")|| (navigator.platform == "wow64");

                                        var isMac = (navigator.platform == "Mac68K") || (navigator.platform == "MacPPC") || (navigator.platform == "Macintosh") || (navigator.platform == "MacIntel");
                                        if (isMac) return "Mac";
                                        var isUnix = (navigator.platform == "X11") && !isWin && !isMac;
                                        if (isUnix) return "Unix";
                                        var isLinux = (String(navigator.platform).indexOf("Linux") > -1);
                                        var bIsAndroid = sUserAgent.toLowerCase().match(/android/i) == "android";
                                        if (isLinux) {
                                            if(bIsAndroid) return "Android";
                                            else return "Linux";
                                        }
                                        if (isWin) {

                                            var isWin2K = sUserAgent.indexOf("Windows nt 5.0") > -1 || sUserAgent.indexOf("Windows 2000") > -1;
                                            if (isWin2K) return "Win2000";
                                            var isWinXP = sUserAgent.indexOf("Windows nt 5.1") > -1 || sUserAgent.indexOf("Windows XP") > -1
                                            sUserAgent.indexOf("Windows XP") > -1;
                                            if (isWinXP) return "WinXP";
                                            var isWin2003 = sUserAgent.indexOf("Windows nt 5.2") > -1 || sUserAgent.indexOf("Windows 2003") > -1;
                                            if (isWin2003) return "Win2003";
                                            var isWinVista= sUserAgent.indexOf("Windows nt 6.0") > -1 || sUserAgent.indexOf("Windows Vista") > -1;
                                            if (isWinVista) return "WinVista";
                                            var isWin7 = sUserAgent.indexOf("Windows nt 6.1") > -1 || sUserAgent.indexOf("Windows 7") > -1;
                                            if (isWin7) return "Win7";
                                            var isWin8 = sUserAgent.indexOf("windows nt 6.2") > -1 || sUserAgent.indexOf("Windows 8") > -1;
                                            if (isWin8) return "Win8";
                                            var isWin10 = sUserAgent.indexOf("windows nt 10.0")>-1||sUserAgent.indexOf("Windows 10")>-1;
                                            if(isWin10)return "Win10";
                                        }
                                        return "其他";
                                    },
                                    getDigits:function(){ //判断当前操作系统的版本号
                                        var sUserAgent = navigator.userAgent.toLowerCase();
                                        var is64 = sUserAgent.indexOf("win64") > -1||sUserAgent.indexOf("wow64") > -1;
                                        if (is64) {
                                            return "64位";
                                        }else{
                                            return "32位";
                                        }
                                    },
                                    getBrowser: function() {  // 获取浏览器名
                                        var rMsie = /(msie\s|trident\/7)([\w\.]+)/;
                                        var rTrident = /(trident)\/([\w.]+)/;
                                        var rEdge = /(chrome)\/([\w.]+)/;//IE

                                        var rFirefox = /(firefox)\/([\w.]+)/;  //火狐
                                        var rOpera = /(opera).+version\/([\w.]+)/;  //旧Opera
                                        var rNewOpera = /(opr)\/(.+)/;  //新Opera 基于谷歌
                                        var rChrome = /(chrome)\/([\w.]+)/; //谷歌
                                        var rUC = /(chrome)\/([\w.]+)/;//UC
                                        var rMaxthon = /(chrome)\/([\w.]+)/;//遨游
                                        var r2345 =  /(chrome)\/([\w.]+)/;//2345
                                        var rQQ =  /(chrome)\/([\w.]+)/;//QQ
                                        //var rMetasr =  /(metasr)\/([\w.]+)/;//搜狗
                                        var rSafari = /version\/([\w.]+).*(safari)/;

                                        var ua = navigator.userAgent.toLowerCase();


                                        var matchBS, matchBS2;

                                        //IE 低版
                                        matchBS = rMsie.exec(ua);
                                        if (matchBS != null) {
                                            matchBS2 = rTrident.exec(ua);
                                            if (matchBS2 != null) {
                                                switch (matchBS2[2]) {
                                                    case "4.0":
                                                        return {
                                                            browser:
                                                                "Microsoft IE",
                                                            version: "IE: 8"  //内核版本号
                                                        };
                                                        break;
                                                    case "5.0":
                                                        return {
                                                            browser:
                                                                "Microsoft IE",
                                                            version: "IE: 9"
                                                        };
                                                        break;
                                                    case "6.0":
                                                        return {
                                                            browser:
                                                                "Microsoft IE",
                                                            version: "IE: 10"
                                                        };
                                                        break;
                                                    case "7.0":
                                                        return {
                                                            browser:
                                                                "Microsoft IE",
                                                            version: "IE: 11"
                                                        };
                                                        break;
                                                    default:
                                                        return {
                                                            browser:
                                                                "Microsoft IE",
                                                            version: "Undefined"
                                                        };
                                                }
                                            } else {
                                                return {
                                                    browser: "Microsoft IE",
                                                    version: "IE:"+matchBS[2] || "0"
                                                };
                                            }
                                        }
                                        //IE最新版
                                        matchBS = rEdge.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent))) {
                                            return {
                                                browser: "Microsoft Edge",
                                                version: "Chrome/"+matchBS[2] || "0"
                                            };
                                        }
                                        //UC浏览器
                                        matchBS = rUC.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent))) {
                                            return {
                                                browser: "UC",
                                                version: "Chrome/"+matchBS[2] || "0"
                                            };
                                        }
                                        //火狐浏览器
                                        matchBS = rFirefox.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent))) {
                                            return {
                                                browser: "火狐",
                                                version: "Firefox/"+matchBS[2] || "0"
                                            };
                                        }
                                        //Oper浏览器
                                        matchBS = rOpera.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent))) {
                                            return {
                                                browser: "Opera",
                                                version: "Chrome/"+matchBS[2] || "0"
                                            };
                                        }
                                        //遨游
                                        matchBS = rMaxthon.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent))) {
                                            return {
                                                browser: "遨游",
                                                version: "Chrome/"+matchBS[2] || "0"
                                            };
                                        }
                                        //2345浏览器
                                        matchBS = r2345.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent))) {
                                            return {
                                                browser: "2345",
                                                version: "Chrome/ "+matchBS[2] || "0"
                                            };
                                        }
                                        //QQ浏览器
                                        matchBS = rQQ.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent))) {
                                            return {
                                                browser: "QQ",
                                                version: "Chrome/"+matchBS[2] || "0"
                                            };
                                        }
                                        //Safari（苹果）浏览器
                                        matchBS = rSafari.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent)) && (!(window.chrome)) && (!(window.opera))) {
                                            return {
                                                browser: "Safari",
                                                version: "Safari/"+matchBS[1] || "0"
                                            };
                                        }
                                        //谷歌浏览器
                                        matchBS = rChrome.exec(ua);
                                        if ((matchBS != null) && (!(window.attachEvent))) {
                                            matchBS2 = rNewOpera.exec(ua);
                                            if (matchBS2 == null) {
                                                return {
                                                    browser: "谷歌",
                                                    version: "Chrome/"+matchBS[2] || "0"
                                                };
                                            } else {
                                                return {
                                                    browser: "Opera",
                                                    version: "opr/"+matchBS2[2] || "0"
                                                };
                                            }
                                        }
                                    }
                                };
                                BrowserMatch.init();
                                brower=BrowserMatch.browser
                                system=BrowserMatch.OS
                                {#alert("当前浏览器为：" + BrowserMatch.browser +"\n版本为："+ BrowserMatch.version + "\n所处操作系统为："+BrowserMatch.OS); #}
                            })(jQuery);


                            //检测平台
                            var p = navigator.platform;
                            system.win = p.indexOf("Win") == 0;
                            system.mac = p.indexOf("Mac") == 0;
                            system.x11 = (p == "X11") || (p.indexOf("Linux") == 0);
                            system.ipad = (navigator.userAgent.match(/iPad/i) != null)?true:false;
                            //跳转语句，如果是手机访问就自动跳转到wap.baidu.com页面
                            if (system.win || system.mac || system.xll||system.ipad) {
                                console.log('电脑端')
                                devide='电脑端'
                            } else if(system.mac)
                            {
                                console.log('MAC端')
                                devide='mac端'
                            }
                            else if(system.xll)
                            {
                                console.log('OK')
                                devide='x11或者Linux端'
                            }
                            else if(system.ipad)
                            {
                                console.log('ipad端')
                                devide='ipad端'
                            }
                            else
                            {
                                console.log('手机端')
                                devide='手机端'
                            }

                            console.log(javascriptexec)

                            $("#blogpagination").whjPaging(
                                "setPage",
                                {currPage: result.currPage, totalPage: result.totalPage, totalSize: result.totalSize}
                            );
                        }
                    }else{
                        alert("数据错误！请联系管理员");
                    }

                },
                error:function(){
                    alert("发生错误");
                }
            });
        }

    </script>
    {#    <script type="text/javascript" scr="{% static 'lib/LoadComment.js' %}" data-id="blogid={{ Blog.id }}"></script>#}
{% endblock %}