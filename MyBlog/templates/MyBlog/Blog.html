{% extends 'MyBlog/base.html' %}
{% load static %}
{% block title%}
    <title>花花与风的博文</title>
{% endblock %}
{% block head %}
    <link rel="stylesheet" href="{% static 'common/css/iconfont.css' %}">
{% endblock %}
{% block container %}
    <div class="layui-col-md9 Tophead">
        <div class="content" id="flow">
        </div>
    </div>
    <div class="layui-col-md3 Tophead" >
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12 ">
                <div class="layui-card webinfo">
                    <div class="layui-card-header">
                        <i class="layui-icon layui-icon-app"></i>
                        <span>文章分类</span>
                    </div>
                    <div class="layui-card-body">
                        <ul>
                            {% if Categorys %}
                                {% for category in Categorys %}
                                    <a href="{% url 'MyBlog:category' category.id %}" title="{{ category.Name }}"><li>{%if category.Name|length >= 25 %}{{category.Name|slice:"25"}}...{%else%} {{category.Name}}{%endif%}</li></a>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="layui-col-md12">
                <div class="layui-card ranker">
                    <div class="layui-card-header">
                        <i class="iconfont icon-wenzhang"></i>
                        <span>点击排行</span>
                    </div>
                    <div class="layui-card-body">
                        <ul>
                            {% if Rankers %}
                                {% for ranker in Rankers %}
                                    <li><a href="{% url 'MyBlog:details' ranker.id %}" title="{{ ranker.title }}">{%if ranker.title|length >= 25 %}
                                        {{ranker.title|slice:"25"}}...
                                    {%else%} {{ranker.title}}
                                    {%endif%}</a></li>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <i class="layui-icon layui-icon-note"></i>
                        <span>标签云</span>
                    </div>
                    <div class="layui-card-body note">
                        {% if Tags %}
                            {% for tag in Tags %}
                                <a  href="{% url 'MyBlog:types' tag.TypeName %}">{{ tag.TypeName }}</a>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block script %}
    <script src="{% static '/js/jquery-3.3.1.min.js' %}"></script>
    <script>
        layui.use('flow', function(){
            var flow = layui.flow;
            flow.load({
                elem: '#flow' //指定列表容器
                ,scrollElem: '#flow' //滚动条所在元素，一般不用填，此处只是演示需要。
                ,done: function(page, next){ //到达临界点（默认滚动触发），触发下一页
                    //以jQuery的Ajax请求为例，请求下一页数据（注意：page是从2开始返回）
                    setTimeout(function() {
                        var lis = [];
                        $.get('../loadblog?page=' + page + '&limit=1',
                            function(res) {
                                console.info(res);
                                //假设你的列表返回在data集合中
                                layui.each(res.data, function(index, item) {
                                    var blogcategorylist=[]
                                    var blogcategory=layui.each(item.blogCategory,function(index,subitem)
                                            {
                                                var item1str='<a href="../category/"'+subitem.id +'">'+subitem.Name+'</a>'
                                                blogcategorylist.push(item1str)
                                            });
                                    var blog_blogtypelist=[]
                                    var blog_blogtype=layui.each(item.blogType,function(index,subitem)
                                            {
                                                var item2str='<a href="../types/"'+subitem.TypeName +'">'+subitem.TypeName+'</a>'
                                                blog_blogtypelist.push(item2str)
                                            });
                                    var str=' <div class="item">\n' +
                                        '                        <div class="header">\n' +
                                        '                            <div class="title"><a href="../details/'+item.id+'" title="'+item.title+'">'+item.title+'</a></div>\n' +
                                        '                            <div class="category">'+blogcategorylist+'</div>\n' +
                                        '                        </div>\n' +
                                        '                        <div class="img"><img src="'+item.imgTitle+'" alt="'+item.title+'"></div>\n' +
                                        '                        <div class="abstract"><a href="../details/"'+item.id+'" title="'+item.title+'">'+item.abstract+'</a></div>\n' +
                                        '                        <div class="author">\n' +
                                        '                            <span class="f_l t_left top">置顶</span>\n' +
                                        '                            <span class="f_l lm">分类：'+blog_blogtypelist+'</span>\n' +
                                        '                            <span class="dtime f_l">发布时间：'+item.createdate+'</span>\n' +
                                        '                            <span class="f_r t_right orign">原创</span>\n' +
                                        '                            <span class="viewnum f_r ">'+item.hit+'次阅读</span>\n' +
                                        '                            <span class="pingl f_r">'+item.commentcount+'条评论</span>\n' +
                                        '                        </div>\n' +
                                        '                    </div>'
                                    lis.push(str);
                                });
                                next(lis.join(''), page < res.count); //假设总页数为 6
                            });
                    }, 500);
                }
            });
        });

    </script>

{% endblock %}
